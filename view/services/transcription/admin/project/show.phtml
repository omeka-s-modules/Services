<?php
$this->headLink()->appendStylesheet($this->assetUrl('css/transcription/styles.css', 'Services'));
$this->headScript()->appendFile($this->assetUrl('js/transcription/scripts.js', 'Services'));
$this->htmlElement('body')->appendAttribute('class', 'services transcription-project show');

$preprocessJob = $project->preprocessJob();
$transcribeJob = $project->transcribeJob();
$fetchJob = $project->fetchJob();
?>

<?php echo $this->pageTitle($this->translate('Project'), 1, $this->translate('Services Â· Transcription'), $project->label()); ?>

<div id="page-actions">
    <div id="page-action-menu">
        <a href="#" class="expand button" aria-label="<?php echo $this->translate('Expand'); ?>"><?php echo $this->translate('Actions'); ?></a>
        <ul class="collapsible">
            <li><?php echo $project->link($this->translate('Edit project'), 'edit'); ?></li>
            <li><a href="#" class="sidebar-content" data-sidebar-selector="#do-preprocess-sidebar"><?php echo $this->translate('Preprocess items'); ?></a></li>
            <li><a href="#" class="sidebar-content" data-sidebar-selector="#do-transcribe-sidebar"><?php echo $this->translate('Transcribe pages'); ?></a></li>
            <li><a href="#" class="sidebar-content" data-sidebar-selector="#do-fetch-sidebar"><?php echo $this->translate('Fetch transcriptions'); ?></a></li>
        </ul>
    </div>
</div>

<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack">
    <thead>
        <tr>
            <th><?php echo $this->translate('Job'); ?></th>
            <th><?php echo $this->translate('Status'); ?></th>
            <th><?php echo $this->translate('Started'); ?></th>
            <th><?php echo $this->translate('Ended'); ?></th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><?php echo $this->translate('Preprocess items'); ?></td>
            <td><?php
                echo $preprocessJob
                    ? sprintf(
                        $this->translate('%s [%s]'),
                        $preprocessJob->link($preprocessJob->statusLabel()),
                        $preprocessJob->log()
                            ? $this->hyperlink($this->translate('view log'), $this->url('admin/id', ['controller' => 'job', 'action' => 'log', 'id' => $preprocessJob->id()]), ['target' => '_blank'])
                            : $this->translate('no log')
                    )
                    : $this->translate('Not started');
            ?></td>
            <td><?php echo $preprocessJob ? $this->i18n()->dateFormat($preprocessJob->started(), 'medium', 'medium') : ''; ?></td>
            <td><?php echo $preprocessJob ? $this->i18n()->dateFormat($preprocessJob->ended(), 'medium', 'medium') : ''; ?></td>
        </tr>
        <tr>
            <td><?php echo $this->translate('Transcribe pages'); ?></td>
            <td><?php
                echo $transcribeJob
                    ? sprintf(
                        $this->translate('%s [%s]'),
                        $transcribeJob->link($transcribeJob->statusLabel()),
                        $transcribeJob->log()
                            ? $this->hyperlink($this->translate('view log'), $this->url('admin/id', ['controller' => 'job', 'action' => 'log', 'id' => $transcribeJob->id()]), ['target' => '_blank'])
                            : $this->translate('no log')
                    )
                    : $this->translate('Not started');
            ?></td>
            <td><?php echo $transcribeJob ? $this->i18n()->dateFormat($transcribeJob->started(), 'medium', 'medium') : ''; ?></td>
            <td><?php echo $transcribeJob ? $this->i18n()->dateFormat($transcribeJob->ended(), 'medium', 'medium') : ''; ?></td>
        </tr>
        <tr>
            <td><?php echo $this->translate('Fetch transcriptions'); ?></td>
            <td><?php
                echo $fetchJob
                    ? sprintf(
                        $this->translate('%s [%s]'),
                        $fetchJob->link($fetchJob->statusLabel()),
                        $fetchJob->log()
                            ? $this->hyperlink($this->translate('view log'), $this->url('admin/id', ['controller' => 'job', 'action' => 'log', 'id' => $fetchJob->id()]), ['target' => '_blank'])
                            : $this->translate('no log')
                    )
                    : $this->translate('Not started');
            ?></td>
            <td></td>
            <td></td>
        </tr>
    </tbody>
</table>

<div id="project-sidebar" class="sidebar always-open">
    <?php echo $this->partial('services/transcription/admin/project/show-details') ?>
</div>

<div id="do-preprocess-sidebar" class="sidebar">
    <?php echo $this->hyperlink('', '#', ['class' => 'sidebar-close o-icon-close', 'title' => $this->translate('Close')]); ?>
    <h3><?php echo $this->translate('Preprocess items'); ?></h3>
    <p><?php echo $this->translate('Prepare items in this project for transcription. This will...'); ?></p>
    <?php echo $this->form($formDoPreprocess); ?>
</div>

<div id="do-transcribe-sidebar" class="sidebar">
    <?php echo $this->hyperlink('', '#', ['class' => 'sidebar-close o-icon-close', 'title' => $this->translate('Close')]); ?>
    <h3><?php echo $this->translate('Transcribe pages'); ?></h3>
    <p><?php echo $this->translate('Transcribe pages in this project. This will...'); ?></p>
    <?php echo $this->form($formDoTranscribe); ?>
</div>

<div id="do-fetch-sidebar" class="sidebar">
    <?php echo $this->hyperlink('', '#', ['class' => 'sidebar-close o-icon-close', 'title' => $this->translate('Close')]); ?>
    <h3><?php echo $this->translate('Fetch transcriptions'); ?></h3>
    <p><?php echo $this->translate('Fetch transcriptions from the transcription service. This will...'); ?></p>
    <?php // echo $this->form($formDoTranscribe); ?>
</div>
